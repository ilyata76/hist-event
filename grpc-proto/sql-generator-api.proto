// с этим proto-файлом связаны сервисы:
//    file-api (+ как клиент)
//    control-api (как клиент)

syntax = "proto3";

package sql_generator_api;

// долгий синхронный процесс (последовательный обход сущностей),
//      выделенный в отдельный сервис
service SQLGeneratorAPI {

  // проверить работоспособность
  rpc Ping (PingR) returns (PongR) {}

  rpc Validate (ManyFilesR) returns (StatusR) {}

  rpc Parse (ManyFilesR) returns (StatusR) {}

  rpc Generate (ManyFilesR) returns (StatusR) {}

  // 
  rpc PutSQLGeneratorStatus (IdentifierStatusR) returns (IdentifierStatusR) {}

  //
  rpc GetSQLGeneratorStatus (IdentifierR) returns (IdentifierStatusR) {}
}

message PingR {
  //
};
message PongR {
  string pong = 1;
};

//

message ManyFilesR {
  // набор файлов
  repeated File files = 1;
  // если есть, сохранит в случае Generate сюда
  optional File main_sql = 2; 
  // строка идентификации операции для разграничения и сохранения порядка
  string identifier = 3;
}

message StatusR {
  string status = 1;
}

message IdentifierR {
  string identifier = 1;
}

message IdentifierStatusR {
  string identifier = 1;
  string status = 2;
}

// классы

message File {
  string storage = 1;
  string path = 2;
  string filename = 3;
  // dates, others и пр. сущностные категории
  string keyword = 4;
};